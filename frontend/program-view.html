<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Program View - IRON AI</title>
    <link rel="stylesheet" href="/static/styles.css" />
</head>
<body class="form-page">
    <div class="form-card" style="max-width:960px;">
        <h2 id="title">Program</h2>
        <div id="week-view" class="form-field">Loading...</div>
        <div id="follow-plan-section" style="margin-top: 2rem; text-align: center; display: none;">
            <button id="follow-plan-btn" class="cta-button" style="font-size: 1.1rem; padding: 1rem 2rem;">
                Follow Plan
            </button>
        </div>
        <p class="muted-text"><a class="link" href="/static/ready-plans.html">Back to plans</a></p>
    </div>
    <script>
    function q(name){ return new URLSearchParams(location.search).get(name); }
    async function fetchJSON(url){ const r=await fetch(url); if(!r.ok) throw new Error('Failed '+url); return r.json(); }
    
    async function init(){
      const programName = q('program_name');
      if(!programName){ document.getElementById('week-view').textContent = 'No program selected'; return; }
      document.getElementById('title').textContent = programName;

      // Load weeks count
      const weeks = await fetchJSON(`/api/programs/${encodeURIComponent(programName)}/weeks`);
      const weeksCount = weeks.weeks_count || 0;
      const c = document.getElementById('week-view');
      c.innerHTML = '';
      if(!weeksCount){ c.textContent = 'No weeks found'; return; }

      // Load week 1 data
      const week1 = await fetchJSON(`/api/programs/${encodeURIComponent(programName)}/weeks/1`);
      if(!week1.days || !week1.days.length){ c.textContent = 'No days found'; return; }

      week1.days.forEach((d, idx)=>{
        const day = document.createElement('div');
        day.className = 'day-card';
        day.style.marginBottom = '12px';
        const dayNumber = (d.day_number != null ? d.day_number : (idx+1));
        day.innerHTML = `<div class="day-title"><h3>Day ${dayNumber}</h3></div>`;
        const list = document.createElement('ul'); list.className = 'exercise-list';
        d.exercises.forEach(name=>{
          const li = document.createElement('li'); li.className = 'exercise-item';
          li.innerHTML = `<div class="exercise-name">${name}</div>`;
          list.appendChild(li);
        });
        day.appendChild(list); c.appendChild(day);
      });

      // Show follow plan button
      document.getElementById('follow-plan-section').style.display = 'block';
    }
    
    // Handle follow plan button click
    document.getElementById('follow-plan-btn').addEventListener('click', function() {
      const programName = q('program_name');
      if(programName) {
        window.location.href = `/static/follow-plan.html?program_name=${encodeURIComponent(programName)}`;
      }
    });
    
    init();
    </script>
</body>
</html>


